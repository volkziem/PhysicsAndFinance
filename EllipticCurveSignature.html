<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2021a"><title>Elliptic-curve signature with ECDSA (Section 12.7)</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: normal; text-align: left;  }
.S1 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: normal; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S2 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: bold; text-align: left;  }
.S6 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: normal; text-align: left;  }
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { color: rgb(64, 64, 64); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
.variableValue { width: 100% !important; }
.embeddedOutputsMatrixElement,.eoOutputWrapper .matrixElement {    min-height: 18px;    box-sizing: border-box;}
.embeddedOutputsMatrixElement .matrixElement,.eoOutputWrapper  .matrixElement,.rtcDataTipElement .matrixElement {    position: relative;}
.matrixElement .variableValue,.rtcDataTipElement .matrixElement .variableValue {    white-space: pre;    display: inline-block;    vertical-align: top;    overflow: hidden;}
.embeddedOutputsMatrixElement.inlineElement {}
.embeddedOutputsMatrixElement.inlineElement .topHeaderWrapper {    display: none;}
.embeddedOutputsMatrixElement.inlineElement .veTable .body {    padding-top: 0 !important;    max-height: 100px;}
.inlineElement .matrixElement {    max-height: 300px;}
.embeddedOutputsMatrixElement.rightPaneElement {}
.rightPaneElement .matrixElement,.rtcDataTipElement .matrixElement {    overflow: hidden;    padding-left: 9px;}
.rightPaneElement .matrixElement {    margin-bottom: -1px;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer,.eoOutputWrapper .matrixElement .valueContainer,.rtcDataTipElement .matrixElement .valueContainer {    white-space: nowrap;    margin-bottom: 3px;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer .horizontalEllipsis.hide,.embeddedOutputsMatrixElement .matrixElement .verticalEllipsis.hide,.eoOutputWrapper .matrixElement .valueContainer .horizontalEllipsis.hide,.eoOutputWrapper .matrixElement .verticalEllipsis.hide,.rtcDataTipElement .matrixElement .valueContainer .horizontalEllipsis.hide,.rtcDataTipElement .matrixElement .verticalEllipsis.hide {    display: none;}
.embeddedOutputsVariableMatrixElement .matrixElement .valueContainer.hideEllipses .verticalEllipsis, .embeddedOutputsVariableMatrixElement .matrixElement .valueContainer.hideEllipses .horizontalEllipsis {    display:none;}
.embeddedOutputsMatrixElement .matrixElement .valueContainer .horizontalEllipsis,.eoOutputWrapper .matrixElement .valueContainer .horizontalEllipsis {    margin-bottom: -3px;}
.eoOutputWrapper .embeddedOutputsVariableMatrixElement .matrixElement .valueContainer {    cursor: default !important;}
.embeddedOutputsVariableElement {    white-space: pre-wrap;    word-wrap: break-word;    min-height: 18px;    max-height: 250px;    overflow: auto;}
.variableElement {}
.embeddedOutputsVariableElement.inlineElement {}
.inlineElement .variableElement {}
.embeddedOutputsVariableElement.rightPaneElement {    min-height: 16px;}
.rightPaneElement .variableElement {    padding-top: 2px;    padding-left: 9px;}
.variableNameElement {    margin-bottom: 3px;    display: inline-block;}
/* * Ellipses as base64 for HTML export. */.matrixElement .horizontalEllipsis,.rtcDataTipElement .matrixElement .horizontalEllipsis {    display: inline-block;    margin-top: 3px;    /* base64 encoded version of images-liveeditor/HEllipsis.png */    width: 30px;    height: 12px;    background-repeat: no-repeat;    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAJCAYAAADO1CeCAAAAJUlEQVR42mP4//8/A70xw0i29BUDFPxnAEtTW37wWDqakIa4pQDvOOG89lHX2gAAAABJRU5ErkJggg==");}
.matrixElement .verticalEllipsis,.textElement .verticalEllipsis,.rtcDataTipElement .matrixElement .verticalEllipsis,.rtcDataTipElement .textElement .verticalEllipsis {    margin-left: 35px;    /* base64 encoded version of images-liveeditor/VEllipsis.png */    width: 12px;    height: 30px;    background-repeat: no-repeat;    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAZCAYAAAAIcL+IAAAALklEQVR42mP4//8/AzGYgWyFMECMwv8QddRS+P//KyimlmcGUOFoOI6GI/UVAgDnd8Dd4+NCwgAAAABJRU5ErkJggg==");}
.S9 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: bold; text-align: left;  }</style></head><body><div class = rtcContent><div  class = 'S0'><span>Companion software for "Volker Ziemann, </span><span style=' font-style: italic;'>Physics and Finance, Springer, 2021</span><span>" (</span><a href = "https://link.springer.com/book/10.1007/978-3-030-63643-2"><span>https://link.springer.com/book/10.1007/978-3-030-63643-2</span></a><span>)</span></div><h1  class = 'S1'><span>Elliptic-curve signature with ECDSA (Section 12.7)</span></h1><div  class = 'S0'><span>Volker Ziemann, 211116, CC-BY-SA-4.0</span></div><div  class = 'S0'><span>This example illustrates the verification of digital signatures based on elliptic-curve cryptography (ECDSA) and is based on Exercise 8 in Chapter 12 and its solution from Chapter 13. In the exercise Alice sends Bob a message (either 'YES' or 'NO') and creates a ECDSA signature </span><span texencoding="(r,s)" style="vertical-align:-5px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAAAmCAYAAACf8yaaAAAEjklEQVRoQ+2ZachWVRDHf5YRWEGbbVoUJBlSEWGbpUV7lhhECe2lCCVKSUnLh6KCaKENFYr2iKKNFpcWTIsWKwhEIsqkPlRKCe1FtPGDuXahe+859/F56/lwB94PD3fOnDn/MzP/mfMOo5ONCAzrsPgHgQ6MUjR0YHRgVBeHtpExGTgNmD7gtWYP4HbgEmBdrq9twJgGXARMAX7J3eB/1DsQuBc4Ffgqx49cMI4GFgCHAd/mGB4QnWOAW4CjgO9TPuWAsQvwYSD8ZsrgAH6/GdgTOCPlWw4YjwN/AGeljA3o922AT4GZwLNNPqbAOBwwGg4AVg3oYXPcug44F9g7LrZyTQqMp4HRwCE5Ow6wjuzyOSAJPFHnZxMYOwDrgWuAmwb4oLmufRDnObEXMM4BHgZMlbdzd/wP9LzAM4Ejgc2AFcBKYD/gfeDLGh/uBmYAOwI/Vuk0RcZ9wPnAVsCvDYfcHDgunNEh/5YAVwFbADcCZwNPAbP7ANbzwAnAhcBiYALwELA9sC3wXc0enuUBQLpd1hYM0R4VNaPpDMODx/cHbgvFU4BXgJeASYCgy0hbJ4BNYSXoLwOvh91C/2LgWmCnBgP2Gq8Bc4C72oLxDbAGODTlYXzfDfgC+B2w3twaYWvh8jaXx41mmqtUM7LujNzfFfgrtAz95yJK6uyPAT4G7gAubQvGb8AbEVY5B7Dt9dDWF9vgscC8WDgiWvjC+Rx7VToTo0b4zdHg/pKSY4L710lxWaaKKfYvqasZ5rpgmPsnZ3p+A3A1MB/YFzgpbGQuz1LTL2/XjtIi6Pxh9OaINWVDUKsUmw2GioJhbh6bsxPwLjA+UsP8XZS5rq2axXNpLHoHOKKpkSoZ7zkytGHN+CSGs5TDI2NUlupMLcN5KEXKl/oV+yAZKyVFzXC0v6xtZLwHOKTtntol5pZHQ+/4YJKMZT2rGPIOjzsHO22XwVJO3lLqrEjlVmlicbKfz6HDR6KXkDnM537L3BJtF7bPAx6MH9KmzVeTWDTtnQRFZmsFRrFYarXnqBOLsG27qSKdXp6JhFHnDX8E/JlYszoO8XVJz7X+NjVrD1jSXwgIoLRf+TjV1IHawPhCdCXgm0CdHBRF0+8HA6ZXSkylF6NDfSuKdNPr2U8Bsg9Mhdjs/RzFU2DrOs9CX0DXxktdpX+pqfWF6OV94aoT6VRa/QzYK4VCfLfxsRMsxLfK8kHLZqwLvmN6MTKHB1J8h7WfsRFz7miSonhOjeasJzAchqRX5w2RrRLZQyd9XrsiEwz17Uds4ZWm9PL5wOZNGh0X0bRlhLsR63ySEvV8yN6nKSVTkeEmT0alLqgstXHb70bfMzFEtV2boy/TGE0Oi429Tw4YhqlRYbvb71HeidjIMgKtC0MhRqCzi2N/o+SAoQGpy2rcz9dxx21fnUyvV1OO9vjdUeL68P+HlI1cMLRzOuCo7EC2qbfovo9F0TQyhkKcW+4Jf7P+kdQGDB12+PLJ/YI+eO/emzrF1rlh1+yo7+VlAaGhtmD0AYPBNdGBUbqbDowOjOpU7SKji4zqyPgbZOrPJ7G2uzQAAAAASUVORK5CYII=" width="33.5" height="19" /></span><span> which she also sends to Bob, who uses Equation 12.35 to verify the authenticity of the message received.</span></div><div  class = 'S0'><span>Alice and Bob first agree on the elliptic curve with parameters </span><span style=' font-family: monospace;'>a</span><span> and </span><span style=' font-family: monospace;'>b</span><span> over an integer field based on a prime </span><span style=' font-family: monospace;'>p</span><span> and a generator point </span><span style=' font-family: monospace;'>G</span><span>, which was previously derived in </span><span style=' font-family: monospace;'>EllipticCurveArithmetic.mlx </span><span>where we also determined that the order of the group, generated by </span><span style=' font-family: monospace;'>G,</span><span> is </span><span style=' font-family: monospace;'>n</span><span>. All these parameters are publicly known.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >p=113; </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >a=0; </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >b=7; </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >G=[15,52]; </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >n=19;</span></span></div></div></div><h3  class = 'S5'><span>Alice signs a message</span></h3><div  class = 'S0'><span>Alice calculates the signature of her message </span><span style=' font-family: monospace;'>m</span><span> by calculating a hash value </span><span style=' font-family: monospace;'>h</span><span> (we use a very simple one based on xor). </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >m=</span><span style="color: rgb(170, 4, 249);">'YES'</span><span >;   </span><span style="color: rgb(2, 128, 9);">% or m='NO';       % message</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >nm=double(m);                 </span><span style="color: rgb(2, 128, 9);">% numeric form</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >h=bitxor(nm(3),bitxor(nm(2),nm(1)));</span></span></div></div></div><div  class = 'S6'><span>Then she comes up with her secret key </span><span style=' font-family: monospace;'>d</span><span> and calculates her private point</span><span style=' font-family: monospace;'> P </span><span>by adding </span><span style=' font-family: monospace;'>G</span><span>, the generator point, </span><span style=' font-family: monospace;'>d </span><span>times.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >d=15;                         </span><span style="color: rgb(2, 128, 9);">% Alice's private key</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >P=G; </span><span style="color: rgb(14, 0, 255);">for </span><span >j=2:d, P=ECadd_p(P,G,a,b,p); </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div></div><div  class = 'S6'><span>The first part of the signature is derived from some random number </span><span style=' font-family: monospace;'>k,</span><span> summing </span><span style=' font-family: monospace;'>G</span><span> a number of </span><span style=' font-family: monospace;'>k</span><span> times to obtain a point </span><span style=' font-family: monospace;'>R</span><span>, whose x-coordinate is first part of the signature.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >k=4;                          </span><span style="color: rgb(2, 128, 9);">% random number</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >R=G; </span><span style="color: rgb(14, 0, 255);">for </span><span >j=2:k, R=ECadd_p(R,G,a,b,p); </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre"><span >r=R(1)                        </span><span style="color: rgb(2, 128, 9);">% 1. part of signature</span></span></div><div  class = 'S8'><div class='variableElement' style='font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px; '>r = 66</div></div></div></div><div  class = 'S6'><span>The second part of the signature </span><span style="font-family: STIXGeneral, STIXGeneral-webfont, serif; font-style: italic; font-weight: normal; color: rgb(0, 0, 0);">s</span><span> is calculated from the hash as </span><span texencoding="s=(h+rd)/k\,(\mathrm{mod}\ n)" style="vertical-align:-5px"><img src="data:image/png;base64,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" width="147" height="19" /></span><span>. The inverse of k is calculated with Equation 12.34. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >kinv=powermod(k,n-2,n);       </span><span style="color: rgb(2, 128, 9);">% 1/k</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre"><span >s=powermod((h+r*d)*kinv,1,n)  </span><span style="color: rgb(2, 128, 9);">% 2. part of signature</span></span></div><div  class = 'S8'><div class='variableElement' style='font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px; '>s = 6</div></div></div></div><div  class = 'S6'><span>Alice now sends the message </span><span style=' font-family: monospace;'>m</span><span> and the signature </span><span texencoding="(r,s)" style="vertical-align:-5px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAAAmCAYAAACf8yaaAAAEjklEQVRoQ+2ZachWVRDHf5YRWEGbbVoUJBlSEWGbpUV7lhhECe2lCCVKSUnLh6KCaKENFYr2iKKNFpcWTIsWKwhEIsqkPlRKCe1FtPGDuXahe+859/F56/lwB94PD3fOnDn/MzP/mfMOo5ONCAzrsPgHgQ6MUjR0YHRgVBeHtpExGTgNmD7gtWYP4HbgEmBdrq9twJgGXARMAX7J3eB/1DsQuBc4Ffgqx49cMI4GFgCHAd/mGB4QnWOAW4CjgO9TPuWAsQvwYSD8ZsrgAH6/GdgTOCPlWw4YjwN/AGeljA3o922AT4GZwLNNPqbAOBwwGg4AVg3oYXPcug44F9g7LrZyTQqMp4HRwCE5Ow6wjuzyOSAJPFHnZxMYOwDrgWuAmwb4oLmufRDnObEXMM4BHgZMlbdzd/wP9LzAM4Ejgc2AFcBKYD/gfeDLGh/uBmYAOwI/Vuk0RcZ9wPnAVsCvDYfcHDgunNEh/5YAVwFbADcCZwNPAbP7ANbzwAnAhcBiYALwELA9sC3wXc0enuUBQLpd1hYM0R4VNaPpDMODx/cHbgvFU4BXgJeASYCgy0hbJ4BNYSXoLwOvh91C/2LgWmCnBgP2Gq8Bc4C72oLxDbAGODTlYXzfDfgC+B2w3twaYWvh8jaXx41mmqtUM7LujNzfFfgrtAz95yJK6uyPAT4G7gAubQvGb8AbEVY5B7Dt9dDWF9vgscC8WDgiWvjC+Rx7VToTo0b4zdHg/pKSY4L710lxWaaKKfYvqasZ5rpgmPsnZ3p+A3A1MB/YFzgpbGQuz1LTL2/XjtIi6Pxh9OaINWVDUKsUmw2GioJhbh6bsxPwLjA+UsP8XZS5rq2axXNpLHoHOKKpkSoZ7zkytGHN+CSGs5TDI2NUlupMLcN5KEXKl/oV+yAZKyVFzXC0v6xtZLwHOKTtntol5pZHQ+/4YJKMZT2rGPIOjzsHO22XwVJO3lLqrEjlVmlicbKfz6HDR6KXkDnM537L3BJtF7bPAx6MH9KmzVeTWDTtnQRFZmsFRrFYarXnqBOLsG27qSKdXp6JhFHnDX8E/JlYszoO8XVJz7X+NjVrD1jSXwgIoLRf+TjV1IHawPhCdCXgm0CdHBRF0+8HA6ZXSkylF6NDfSuKdNPr2U8Bsg9Mhdjs/RzFU2DrOs9CX0DXxktdpX+pqfWF6OV94aoT6VRa/QzYK4VCfLfxsRMsxLfK8kHLZqwLvmN6MTKHB1J8h7WfsRFz7miSonhOjeasJzAchqRX5w2RrRLZQyd9XrsiEwz17Uds4ZWm9PL5wOZNGh0X0bRlhLsR63ySEvV8yN6nKSVTkeEmT0alLqgstXHb70bfMzFEtV2boy/TGE0Oi429Tw4YhqlRYbvb71HeidjIMgKtC0MhRqCzi2N/o+SAoQGpy2rcz9dxx21fnUyvV1OO9vjdUeL68P+HlI1cMLRzOuCo7EC2qbfovo9F0TQyhkKcW+4Jf7P+kdQGDB12+PLJ/YI+eO/emzrF1rlh1+yo7+VlAaGhtmD0AYPBNdGBUbqbDowOjOpU7SKji4zqyPgbZOrPJ7G2uzQAAAAASUVORK5CYII=" width="33.5" height="19" /></span><span> to Bob.</span></div><h3  class = 'S5'><span>Bob verifies the signature</span></h3><div  class = 'S0'><span>Now Bob must verify the message he received in plaintext in order to be sure that Eve, who wants to mess up the relation between Alice and Bob, did not fake the message. He therefore first calculates the hash </span><span style=' font-family: monospace;'>h</span><span> of the received message </span><span style=' font-family: monospace;'>m</span><span> using the same hash function as Alice.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >m=</span><span style="color: rgb(170, 4, 249);">'YES'</span><span >;   </span><span style="color: rgb(2, 128, 9);">% or m='NO';       % received message</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >nm=double(m);                 </span><span style="color: rgb(2, 128, 9);">% numeric form</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >h=bitxor(nm(3),bitxor(nm(2),nm(1)));  </span><span style="color: rgb(2, 128, 9);">% hash value</span></span></div></div></div><div  class = 'S6'><span>And then he uses Equation 12.35 to calculate Q, whose x-coordinate should agree with r, the x-coordinate of R that Alice had derived and used as part of her signature.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span >sinv=powermod(s,n-2,n);       </span><span style="color: rgb(2, 128, 9);">% 1/s</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >hs=powermod(h*sinv,1,n);      </span><span style="color: rgb(2, 128, 9);">% h/s</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >rs=powermod(r*sinv,1,n);      </span><span style="color: rgb(2, 128, 9);">% r/s</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >Q1=G; </span><span style="color: rgb(14, 0, 255);">for </span><span >j=2:hs, Q1=ECadd_p(Q1,G,a,b,p); </span><span style="color: rgb(14, 0, 255);">end</span><span >  </span><span style="color: rgb(2, 128, 9);">% (h/s)*G</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >Q2=P; </span><span style="color: rgb(14, 0, 255);">for </span><span >j=2:rs, Q2=ECadd_p(Q2,P,a,b,p); </span><span style="color: rgb(14, 0, 255);">end</span><span >  </span><span style="color: rgb(2, 128, 9);">% (r/s)*P</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre"><span >Q=ECadd_p(Q1,Q2,a,b,p)        </span><span style="color: rgb(2, 128, 9);">% (h/s)*G+(r/s)*P</span></span></div><div  class = 'S8'><div class="inlineElement eoOutputWrapper embeddedOutputsVariableMatrixElement" uid="27B63DC0" data-scroll-top="null" data-scroll-left="null" data-width="1334" data-testid="output_2" style="width: 1364px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="matrixElement veSpecifier" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="veVariableName variableNameElement double" style="width: 1334px; white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="headerElementClickToInteract" style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><span style="white-space: normal; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">Q = </span><span class="veVariableValueSummary veMetaSummary" style="white-space: normal; font-style: normal; color: rgb(179, 179, 179); font-size: 12px;">1×2</span></div></div><div class="valueContainer" data-layout="{&quot;columnWidth&quot;:44,&quot;totalColumns&quot;:2,&quot;totalRows&quot;:1,&quot;charsPerColumn&quot;:6}" style="white-space: nowrap; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"><div class="variableValue" style="width: 90px; white-space: pre; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;">    66   101
</div><div class="horizontalEllipsis hide" style="white-space: nowrap; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"></div><div class="verticalEllipsis hide" style="white-space: nowrap; font-style: normal; color: rgb(64, 64, 64); font-size: 12px;"></div></div></div></div></div></div></div><div  class = 'S6'><span>And here </span><span style=' font-family: monospace;'>Q(1)</span><span> should be the same as the first part of the signature </span><span style=' font-family: monospace;'>r</span><span>. Note that the purpose of the signature is an elaborate scheme to transmit Alice's secret information across an unsafe communication channel, without actually divulging the secret, yet giving anyone enough infromation to verify the authenticity of the message, because only Alice could have prepared a signature  that is consistent with the received message.</span></div><h2  class = 'S9'><span>Appendix</span></h2><div  class = 'S0'><span>The function </span><span style=' font-family: monospace;'>ECadd_p()</span><span> receives two points </span><span style=' font-family: monospace;'>Pa </span><span>and </span><span style=' font-family: monospace;'>Pb</span><span> on an elliptic curve, which is specified by parameters </span><span style=' font-family: monospace;'>a</span><span> and </span><span style=' font-family: monospace;'>b</span><span>, as well as the base</span><span style=' font-family: monospace;'> p</span><span>. It returns a new point on the same curve </span><span style=' font-family: monospace;'>Pc</span><span> that is calculated from Equation 12.32 and 12.33. The handling of special cases is discussed in Section 12.7.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">function </span><span >Pc=ECadd_p(Pa,Pb,a,b,p)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >Pa(2) == Inf, Pc=Pb; </span><span style="color: rgb(14, 0, 255);">return</span><span >; </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >Pb(2) == Inf, Pc=Pa; </span><span style="color: rgb(14, 0, 255);">return</span><span >; </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >Pa(1) == Pb(1) &amp; Pa(2) ~= Pb(2), Pc=[0,Inf]; </span><span style="color: rgb(14, 0, 255);">return</span><span >; </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">if </span><span >Pa(1) == Pb(1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >  </span><span style="color: rgb(14, 0, 255);">if </span><span >Pa(2) == Pb(2) &amp; Pa(2) == 0</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    Pc=[0,Inf];    </span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">return</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >  </span><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    denominv=powermod(2*Pa(2),p-2,p);  </span><span style="color: rgb(2, 128, 9);">% was 1</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >    s=powermod((3*Pa(1)*Pa(1)+a)*denominv,1,p);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >  </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >  denominv=powermod(Pb(1)-Pa(1),p-2,p);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >  s=powermod((Pb(2)-Pa(2))*denominv,1,p);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >Pc(1)=powermod(s*s-Pa(1)-Pb(1),1,p);</span></span></div></div><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >Pc(2)=powermod(-s*(Pc(1)-Pa(1))-Pa(2),1,p);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div></div><div  class = 'S6'></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% 
% Companion software for "Volker Ziemann, _Physics and Finance, Springer, 2021_" 
% (<https://link.springer.com/book/10.1007/978-3-030-63643-2 https://link.springer.com/book/10.1007/978-3-030-63643-2>)
%% Elliptic-curve signature with ECDSA (Section 12.7)
% Volker Ziemann, 211116, CC-BY-SA-4.0
% 
% This example illustrates the verification of digital signatures based on elliptic-curve 
% cryptography (ECDSA) and is based on Exercise 8 in Chapter 12 and its solution 
% from Chapter 13. In the exercise Alice sends Bob a message (either 'YES' or 
% 'NO') and creates a ECDSA signature $(r,s)$ which she also sends to Bob, who 
% uses Equation 12.35 to verify the authenticity of the message received.
% 
% Alice and Bob first agree on the elliptic curve with parameters |a| and |b| 
% over an integer field based on a prime |p| and a generator point |G|, which 
% was previously derived in |EllipticCurveArithmetic.mlx| where we also determined 
% that the order of the group, generated by |G,| is |n|. All these parameters 
% are publicly known.

p=113; 
a=0; 
b=7; 
G=[15,52]; 
n=19;
% Alice signs a message
% Alice calculates the signature of her message |m| by calculating a hash value 
% |h| (we use a very simple one based on xor). 

m='YES';   % or m='NO';       % message
nm=double(m);                 % numeric form
h=bitxor(nm(3),bitxor(nm(2),nm(1)));
%% 
% Then she comes up with her secret key |d| and calculates her private point 
% |P| by adding |G|, the generator point, |d| times.

d=15;                         % Alice's private key
P=G; for j=2:d, P=ECadd_p(P,G,a,b,p); end
%% 
% The first part of the signature is derived from some random number |k,| summing 
% |G| a number of |k| times to obtain a point |R|, whose x-coordinate is first 
% part of the signature.

k=4;                          % random number
R=G; for j=2:k, R=ECadd_p(R,G,a,b,p); end
r=R(1)                        % 1. part of signature
%% 
% The second part of the signature $s$ is calculated from the hash as $s=(h+rd)/k\,(\mathrm{mod}\ 
% n)$. The inverse of k is calculated with Equation 12.34. 

kinv=powermod(k,n-2,n);       % 1/k
s=powermod((h+r*d)*kinv,1,n)  % 2. part of signature
%% 
% Alice now sends the message |m| and the signature $(r,s)$ to Bob.
% Bob verifies the signature
% Now Bob must verify the message he received in plaintext in order to be sure 
% that Eve, who wants to mess up the relation between Alice and Bob, did not fake 
% the message. He therefore first calculates the hash |h| of the received message 
% |m| using the same hash function as Alice.

m='YES';   % or m='NO';       % received message
nm=double(m);                 % numeric form
h=bitxor(nm(3),bitxor(nm(2),nm(1)));  % hash value
%% 
% And then he uses Equation 12.35 to calculate Q, whose x-coordinate should 
% agree with r, the x-coordinate of R that Alice had derived and used as part 
% of her signature.

sinv=powermod(s,n-2,n);       % 1/s
hs=powermod(h*sinv,1,n);      % h/s
rs=powermod(r*sinv,1,n);      % r/s
Q1=G; for j=2:hs, Q1=ECadd_p(Q1,G,a,b,p); end  % (h/s)*G
Q2=P; for j=2:rs, Q2=ECadd_p(Q2,P,a,b,p); end  % (r/s)*P
Q=ECadd_p(Q1,Q2,a,b,p)        % (h/s)*G+(r/s)*P
%% 
% And here |Q(1)| should be the same as the first part of the signature |r|. 
% Note that the purpose of the signature is an elaborate scheme to transmit Alice's 
% secret information across an unsafe communication channel, without actually 
% divulging the secret, yet giving anyone enough infromation to verify the authenticity 
% of the message, because only Alice could have prepared a signature  that is 
% consistent with the received message.
%% Appendix
% The function |ECadd_p()| receives two points |Pa| and |Pb| on an elliptic 
% curve, which is specified by parameters |a| and |b|, as well as the base |p|. 
% It returns a new point on the same curve |Pc| that is calculated from Equation 
% 12.32 and 12.33. The handling of special cases is discussed in Section 12.7.

function Pc=ECadd_p(Pa,Pb,a,b,p)
if Pa(2) == Inf, Pc=Pb; return; end
if Pb(2) == Inf, Pc=Pa; return; end
if Pa(1) == Pb(1) & Pa(2) ~= Pb(2), Pc=[0,Inf]; return; end
if Pa(1) == Pb(1)
  if Pa(2) == Pb(2) & Pa(2) == 0
    Pc=[0,Inf];    
    return
  else
    denominv=powermod(2*Pa(2),p-2,p);  % was 1
    s=powermod((3*Pa(1)*Pa(1)+a)*denominv,1,p);
  end
else
  denominv=powermod(Pb(1)-Pa(1),p-2,p);
  s=powermod((Pb(2)-Pa(2))*denominv,1,p);
end
Pc(1)=powermod(s*s-Pa(1)-Pb(1),1,p);
Pc(2)=powermod(-s*(Pc(1)-Pa(1))-Pa(2),1,p);
end
%% 
%
##### SOURCE END #####
-->
</div></body></html>